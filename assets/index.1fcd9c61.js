var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,i=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))r.call(t,n)&&l(e,n,t[n]);return e},s=(e,a)=>t(e,n(a)),c=(e,t)=>{var n={};for(var l in e)o.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&a)for(var l of a(e))t.indexOf(l)<0&&r.call(e,l)&&(n[l]=e[l]);return n};import{R as d,a as m,F as u,I as p,T as g,L as h,b as f,m as b,u as E,B as v,S as x,c as y,M as w,d as C,e as S,f as T,g as _,h as k,C as R,i as O,j as L,k as P,l as A,V as I,n as F,o as D,p as j,q as z,r as M,s as N,t as B,v as G,J as W,w as $,x as H,y as Y,z as q,A as V,D as U,E as X,G as K,H as J,K as Q,N as Z,O as ee,P as te,Q as ne,U as ae,W as oe,X as re,Y as le,Z as ie,_ as se,$ as ce,a0 as de,a1 as me,a2 as ue,a3 as pe,a4 as ge,a5 as he,a6 as fe,a7 as be,a8 as Ee,a9 as ve,aa as xe,ab as ye,ac as we,ad as Ce,ae as Se,af as Te,ag as _e,ah as ke,ai as Re,aj as Oe,ak as Le,al as Pe,am as Ae,an as Ie,ao as Fe,ap as De,aq as je,ar as ze,as as Me,at as Ne,au as Be,av as Ge,aw as We,ax as $e,ay as He,az as Ye,aA as qe,aB as Ve,aC as Ue,aD as Xe,aE as Ke,aF as Je,aG as Qe,aH as Ze,aI as et,aJ as tt,aK as nt,aL as at,aM as ot,aN as rt,aO as lt,aP as it,aQ as st,aR as ct,aS as dt,aT as mt,aU as ut,aV as pt,aW as gt,aX as ht,aY as ft,aZ as bt,a_ as Et,a$ as vt}from"./vendor.e950dbbb.js";const xt=()=>d.createElement(m,{to:"/data"}),yt=e=>{var t=e,{icon:n,onClick:a,text:o,textGap:r}=t,l=c(t,["icon","onClick","text","textGap"]);return d.createElement(u,i({_hover:{textColor:"orange.600"},_focus:{outline:"none",textColor:"orange.600"},alignItems:"center",as:"button",_disabled:{color:"gray.400"},flexWrap:"nowrap",paddingX:5,paddingY:4,textColor:"gray.600",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||a&&a(e)},onMouseDown:e=>{e.preventDefault(),0===e.button&&a&&a(e)}},l),d.createElement(p,{as:n,width:6,height:6}),d.createElement(g,{fontWeight:"semibold",marginLeft:null!=r?r:6,whiteSpace:"nowrap"},o))},wt=e=>d.createElement(h,s(i({},e),{as:f}),e.children),Ct=b(u),St=e=>{var t,n,a;const{isOpen:o,onClose:r,onOpen:l}=E();return d.createElement(Ct,{backgroundColor:"white",onMouseEnter:l,onMouseLeave:r,initial:{x:-20},animate:{x:0},exit:{x:-20}},d.createElement(v,i({"aria-label":"Sidebar actions",boxShadow:"xl",role:"region"},e),d.createElement(x,{_focusWithin:{width:null!=(t=e.maxWidth)?t:"15rem"},as:"section",overflowX:"hidden",paddingX:1,paddingY:"1rem",position:"sticky",top:0,transitionProperty:"width",transitionDuration:"0.2s",transitionTimingFunction:"linear forwards",width:o?null!=(n=e.maxWidth)?n:"15rem":null!=(a=e.minWidth)?a:"4.5rem"},e.children)))},Tt=e=>{var t=e,{title:n}=t,a=c(t,["title"]);const o=y({base:"full",md:"md"});return d.createElement(w,i({scrollBehavior:"inside",size:o},a),d.createElement(C,null),d.createElement(S,{margin:"full"===o?0:void 0},d.createElement(T,null,n),d.createElement(_,null),d.createElement(k,{pb:0},a.children)))},_t=e=>{var t=e,{name:n,onDelete:a,onSelect:o}=t,r=c(t,["name","onDelete","onSelect"]);return d.createElement(v,i({_focus:{outline:"none",borderColor:"orange.600"},_focusWithin:{borderColor:"orange.600"},_hover:{borderColor:"orange.600"},border:"1px",borderColor:"transparent",as:"section",backgroundColor:"white",boxShadow:"md",maxWidth:"container.md",padding:"1.5rem",role:"group",width:"100%"},r),d.createElement(u,{alignItems:"center",justifyContent:"space-between"},d.createElement(g,{fontWeight:"semibold"},n),o&&d.createElement(R,{"aria-label":`Add ${n} to selection`,colorScheme:"orange",onChange:e=>{o&&o(n,e.target.checked)}})),a&&d.createElement(O,{_groupHover:{diplay:"flex"},"aria-label":`Delete ${n}`,color:"red.600",marginTop:".5rem",onClick:()=>{a&&a(n)},rightIcon:d.createElement(L,null),size:"sm",variant:"ghost"},"Delete"))},kt=e=>{var t=e,{children:n,controlProps:a,groupProps:o,hideLabel:r,initialFocusRef:l,label:m,leftChildren:u,name:p,rightChildren:g,validate:h}=t,f=c(t,["children","controlProps","groupProps","hideLabel","initialFocusRef","label","leftChildren","name","rightChildren","validate"]);const[b,E]=P({name:p,validate:h});return d.createElement(A,s(i({},a),{isInvalid:void 0!==E.error&&void 0!==E.touched,isRequired:f.isRequired}),r?d.createElement(I,null,d.createElement(F,{fontWeight:"semibold"},m)):d.createElement(F,{fontWeight:"semibold"},m),d.createElement(D,i({as:"span"},o),u,d.createElement(j,i({ref:e=>l?l.current=e:e,name:b.name,onBlur:b.onBlur,onChange:b.onChange,multiple:b.multiple,value:b.value},f)),n,g),d.createElement(z,{as:"span"},E.error))};function Rt(e){return"number"==typeof e&&!isNaN(e)}function Ot(e,t){const n=t.shift();return 1===t.length?("object"==typeof(a=e)&&0===Object.keys(a).length||!e[n]?e[n]=t:e[n]=[...e[n],...t],e):(e[n]||(e[n]={}),e[n]=Ot(e[n],t),e);var a}class Lt{constructor(){this.header=[],this.rows={},this.config={multiHeader:""},N(this)}loadFromObject(e,t){Object.assign(this.config,t),this.header=e.header,this.rows=e.rows}get colNames(){return[...this.header]}get groupsAsArray(){return Object.keys(this.headerObject)}get hasData(){return this.colNames.length>0}get headerObject(){return Array.from(this.colNames.map((e=>e.split(this.config.multiHeader)))).reduce(Ot,{})}get rowNames(){return Object.keys(this.rows)}get samplesAsArray(){const e=[];return Object.values(this.headerObject).forEach((t=>{e.push(...Object.keys(t))})),[...new Set(e)]}getRow(e){return this.rows[e]}getRowAsMap(e){return t=this.colNames,n=this.getRow(e),t.reduce(((e,t,a)=>(e.set(t,n[a]),e)),new Map);var t,n}getRowAsTree(e){const t=this.rows[e];return this.header.reduce(((e,n,a)=>{const o=n.split(this.config.multiHeader),r=o[0],l=o[1];return e[r]?e[r][l]?e[r][l].push(t[a]):e[r][l]=[t[a]]:e[r]={[l]:[t[a]]},e}),{})}getRows(e){return Object.fromEntries(e.map((e=>[e,this.getRow(e)])))}getSubheaderColors(e){const t=this.colNames.map((t=>t.split(this.config.multiHeader).slice(0,e).join(this.config.multiHeader))),n=function(e){const t=M(e.size),n=Array.from(e.values()).map(((e,n)=>[e,t[n]]));return Object.fromEntries(n)}(new Set(t));return t.map((e=>n[e]))}toArrayOfRows(e=[]){const t=(t,n)=>e.includes(t)?n:void 0;let n=[];e.length>0&&(n=e.map(t).filter(Rt));const a=(e,t)=>n.includes(t),o=e=>parseFloat(e);return Object.entries(this.rows).map((t=>{const[,r]=t;let l=r;return e&&n.length>0&&(l=r.filter(a)),l.map(o)}))}toArrayOfColumns(e=[]){const t=this.toArrayOfRows(e);return t[0].map(((e,n)=>t.map((e=>e[n]))))}toBins(e=!1){let t;return t=Object.entries(this.rows).map((e=>{const[t,n]=e;return{bin:t,bins:n.map(((e,t)=>({bin:this.colNames[t],count:parseFloat(e)})))}})),e&&(t=this.colNames.map(((e,n)=>({bin:e,bins:t.map((({bin:e,bins:t})=>({bin:e,count:t[n].count})))})))),t}toString(e){let t="Gene-ID"+e;return t+=this.header.join(e),t+="\n",Object.keys(this.rows).forEach((n=>{t+=n+e,t+=this.rows[n].join(e),t+="\n"})),t}addColumn(e,t){this.header.push(e),t.forEach((([e,t])=>{this.rows[e]?this.rows[e].push(t):console.warn(`${e} is not a known gene accession`)}))}addRow(e,t){this.rows[e]=t}clearData(){this.header=[],this.rows={}}removeColumns(...e){const t=this.colNames.filter((t=>!e.includes(t))),n=new Set(this.colNames.map(((t,n)=>e.includes(t)?n:void 0)).filter((e=>void 0!==e))),a=Object.fromEntries(Object.entries(this.rows).map((([e,t])=>[e,t.filter(((e,t)=>!n.has(t)))])));this.header=t,this.rows=a}}const Pt=new Lt,At=new Lt;const It=new class{constructor(e){this._PRELOADED={data:"",info:"",image:"",settings:""},this._gxpSettings={unit:"",expression_field_sep:"\t",expression_header_sep:"*",info_field_sep:"\t",groupOrder:[],sampleOrder:[]},this._isPreloading=!1,Object.assign(this._PRELOADED,e),N(this)}get preloaded(){return this._PRELOADED}get isPreloading(){return this.preloaded.data&&!Pt.hasData}get gxpSettings(){return this._gxpSettings}get groupOrder(){return this._gxpSettings.groupOrder}get sampleOrder(){return this._gxpSettings.sampleOrder}get unit(){return this._gxpSettings.unit}loadgxpSettings(e){Object.assign(this._gxpSettings,e)}setGroupOrder(e){this._gxpSettings.groupOrder=e}setSampleOrder(e){this._gxpSettings.sampleOrder=e}}({data:"",info:"",image:"",settings:""});function Ft(e){return e.replace(/\\t|\\s/,(e=>{switch(e){case"\\t":return"\t";case"\\s":return"s";default:return e}}))}const Dt=e=>{const t=e=>{if(!e)return"A file name is required"},n=e=>{let t;return e?(e.length>1&&"\\"!==e[0]||e.length>2)&&(t="Separators must be one character long (escaped characters are supported)"):t="A separator value is required",t};return d.createElement(B,{initialValues:{columnSep:(a=It.gxpSettings.expression_field_sep,a.replace(/\t|\s/,(e=>{switch(e){case"\t":return"\\t";case" ":return"\\s";default:return e}}))),fileName:"GXP_Database"},onSubmit:e.onSubmit,validateOnBlur:!1},(a=>d.createElement(v,{as:G,id:"export-gxp-db",sx:{"& p:not(:first-of-type)":{marginTop:"1rem"}}},d.createElement(kt,{initialFocusRef:e.initialFocusRef,name:"columnSep",label:"Column Separator",validate:n,isRequired:!0}),d.createElement(kt,{name:"fileName",label:"File Name",validate:t,isRequired:!0}),e.children?"function"==typeof e.children?e.children(a):e.children:d.createElement(u,{as:"p",paddingY:6,justifyContent:"flex-end"},d.createElement(O,{onClick:e.onCancel,variant:"ghost"},"Cancel"),d.createElement(O,{colorScheme:"orange",isLoading:a.isSubmitting,marginLeft:".5rem",type:"submit",variant:"solid"},"Export")))));var a},jt=e=>{var t,n,a=e,{hideLabel:o,initialFocusRef:r,label:l,name:m,validate:u}=a,p=c(a,["hideLabel","initialFocusRef","label","name","validate"]);const[g,h,f]=P({name:m,validate:u}),b=d.useRef(null),E=()=>{var e;null==(e=b.current)||e.click()};return d.createElement(A,{as:"p",isInvalid:void 0!==h.error&&void 0!==h.touched,isRequired:p.isRequired,isReadOnly:!0},o?d.createElement(I,null,d.createElement(F,{fontWeight:"semibold"},l)):d.createElement(F,{fontWeight:"semibold"},l),d.createElement(j,s(i(i({},g),p),{ref:e=>r?r.current=e:e,onMouseDown:e=>{0===e.button&&E()},onKeyDown:e=>{" "===e.key&&E()},placeholder:"Select a file to load",onChange:e=>e,value:null!=(n=null==(t=g.value)?void 0:t.name)?n:""})),d.createElement(j,{ref:e=>b.current=e,hidden:!0,id:`hidden-${g.name}`,name:`hidden-${g.name}`,type:"file",onChange:e=>{var t;const n=null==(t=e.currentTarget.files)?void 0:t.item(0);n&&f.setValue(n)}}),d.createElement(z,{as:"span"},h.error))},zt=e=>{const t=async e=>{if(!e)return"A file input is required";const t=new W,n=await t.loadAsync(e);return void 0===n.files["GXP_settings.json"]?'The database does not contain the "GXP_settings.json" file.':void 0===n.files["expression_table.txt"]?'The database does not contain the "expression_table.txt" file.':void 0};return d.createElement(B,{initialValues:{},onSubmit:e.onSubmit,validateOnBlur:!1},(n=>d.createElement(v,{as:G,id:"import-gxp-db",sx:{"& p:not(:first-of-type)":{marginTop:"1rem"}}},d.createElement(jt,{initialFocusRef:e.initialFocusRef,name:"file",label:"Tabular File",validate:t,isRequired:!0}),e.children?"function"==typeof e.children?e.children(n):e.children:d.createElement(u,{as:"p",paddingY:6,justifyContent:"flex-end"},d.createElement(O,{onClick:e.onCancel,variant:"ghost"},"Cancel"),d.createElement(O,{colorScheme:"orange",isLoading:n.isSubmitting,marginLeft:".5rem",type:"submit",variant:"solid"},"Import")))))},Mt=e=>{const t=e=>{if(!e)return"A file input is required"},n=e=>{let t;return e?(e.length>1&&"\\"!==e[0]||e.length>2)&&(t="Separators must be one character long (escaped characters are supported)"):t="A separator value is required",t};return d.createElement(B,{initialValues:{columnSep:"\\t"},onSubmit:e.onSubmit,validateOnBlur:!1},(a=>d.createElement(v,{as:G,id:"load-gene-info-table",sx:{"& p:not(:first-of-type)":{marginTop:"1rem"}}},d.createElement(kt,{initialFocusRef:e.initialFocusRef,name:"columnSep",label:"Column Separator",validate:n,isRequired:!0}),d.createElement(jt,{name:"file",label:"Tabular File",validate:t,isRequired:!0}),e.children?"function"==typeof e.children?e.children(a):e.children:d.createElement(u,{as:"p",paddingY:6,justifyContent:"flex-end"},d.createElement(O,{onClick:e.onCancel,variant:"ghost"},"Cancel"),d.createElement(O,{colorScheme:"orange",isLoading:a.isSubmitting,marginLeft:".5rem",type:"submit",variant:"solid"},"Load")))))},Nt=e=>{const t=e=>{if(!e)return"A file input is required"},n=e=>{let t;return e?(e.length>1&&"\\"!==e[0]||e.length>2)&&(t="Separators must be one character long (escaped characters are supported)"):t="A separator value is required",t};return d.createElement(B,{initialValues:{countUnit:"Raw",headerSep:"*",columnSep:"\\t"},onSubmit:e.onSubmit,validateOnBlur:!1},(a=>d.createElement(v,{as:G,id:"load-xtable",sx:{"& p:not(:first-of-type)":{marginTop:"1rem"}}},d.createElement(kt,{name:"countUnit",label:"Count Unit",initialFocusRef:e.initialFocusRef}),d.createElement(kt,{name:"headerSep",label:"Header Separator",validate:n,isRequired:!0}),d.createElement(kt,{name:"columnSep",label:"Column Separator",validate:n,isRequired:!0}),d.createElement(jt,{name:"file",label:"Tabular File",validate:t,isRequired:!0}),e.children?"function"==typeof e.children?e.children(a):e.children:d.createElement(u,{as:"p",paddingY:6,justifyContent:"flex-end"},d.createElement(O,{onClick:e.onCancel,variant:"ghost"},"Cancel"),d.createElement(O,{colorScheme:"orange",isLoading:a.isSubmitting,marginLeft:".5rem",type:"submit",variant:"solid"},"Load")))))};function Bt(e,t){if(e.isLeaf)return{name:t[e.index]};return{name:q(),children:e.children.map((e=>Bt(e,t)))}}function Gt(e,t){if(e.isLeaf)return t?{[t[e.index]]:e.index}:[e.index];if(t){return e.children.reduce(((e,n)=>{const a=Gt(n,t);return i(i({},e),a)}),{})}return e.children.reduce(((e,t)=>{const n=Gt(t);return e.push(...n),e}),[])}async function Wt(e){var t;const n=Pt.toArrayOfColumns(null==e?void 0:e.replicates),a=(null==(t=null==e?void 0:e.replicates)?void 0:t.length)?e.replicates:Pt.colNames,o=$(n,H["euclidean"]);const r=function(e,t){return Y(e,{isDistanceMatrix:!0,method:t})}(o,"ward"),l=Bt(r,a),i=Gt(r,a);var s,c;return{bins:function(e,t,n){return t.map((a=>{const o=e[a];return n?n.map((e=>o[e])):t.map((e=>o[e]))}))}(o,Object.values(i)).map((s=Object.keys(i),(e,t)=>({bin:s[t],bins:e.map(((e,t)=>({bin:c?c[t]:s[t],count:e})))}))),tree:l}}function $t(e){e.setAttribute("xlink","http://www.w3.org/1999/xlink");const t=function(e){const t=[];t.push("#"+e.id);for(let r=0;r<e.classList.length;r++)Ht("."+e.classList[r],t)||t.push("."+e.classList[r]);const n=e.getElementsByTagName("*");for(let r=0;r<n.length;r++){const e=n[r].id;Ht("#"+e,t)||t.push("#"+e);const a=n[r].classList;for(let n=0;n<a.length;n++)Ht("."+a[n],t)||t.push("."+a[n])}let a="";for(let r=0;r<document.styleSheets.length;r++){const e=document.styleSheets[r];try{if(!e.cssRules)continue}catch(o){if("SecurityError"!==o.name)throw o;continue}const n=e.cssRules;for(let o=0;o<n.length;o++){Ht(n[o].selectorText,t)&&(a+=n[o].cssText)}}return a}(e),n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=t;const a=e.hasChildNodes()?e.children[0]:null;e.insertBefore(n,a);let o=(new XMLSerializer).serializeToString(e);return o=o.replace(/(\w+)?:?xlink=/g,"xmlns:xlink="),o=o.replace(/NS\d+:href/g,"xlink:href"),o}function Ht(e,t){return-1!==t.indexOf(e)}const Yt=e=>{var t=e,{status:n,figureRef:a,plotType:o}=t,r=c(t,["status","figureRef","plotType"]);return d.createElement(u,i({_focus:{outline:"none",border:"1px solid",borderColor:"orange.600"},as:"figure",alignItems:"center",backgroundColor:"white",border:"1px solid",borderColor:"transparent",boxShadow:"sm",flexDirection:"column",justifyContent:"center",margin:3,overflow:"hidden",height:800,padding:6,position:"relative",ref:e=>a?a.current=e:e,resize:"horizontal",role:"group",tabIndex:0,width:"100%"},r),"idle"===n?d.createElement(d.Fragment,null,("heatmap"===o||"image"===o)&&d.createElement(v,{_focusWithin:{"& button":{visibility:"visible"}},"aria-label":"Plot actions",as:"section",left:5,position:"absolute",top:5},"heatmap"===o&&d.createElement(X,{_focus:{border:"1px solid",borderColor:"orange.600",color:"orange.600",outline:"none",visibility:"visible"},_groupFocus:{visibility:"visible"},_groupHover:{visibility:"visible"},_hover:{color:"orange.600"},"aria-label":"Download plot",color:"gray.600",icon:d.createElement(K,null),variant:"outline",size:"lg",onClick:()=>{var e;const t=null==(e=null==a?void 0:a.current)?void 0:e.getElementsByClassName("main-svg")[0],n=t?$t(t):"",o=new Blob([n],{type:"image/svg+xml"});saveAs(o,"plot.svg")},visibility:"hidden"}),d.createElement(X,{_focus:{border:"1px solid",borderColor:"orange.600",color:"orange.600",outline:"none",visibility:"visible"},_groupFocus:{visibility:"visible"},_groupHover:{visibility:"visible"},_hover:{color:"orange.600"},"aria-label":"Delete plot",color:"gray.600",icon:d.createElement(J,null),marginLeft:2,size:"lg",variant:"outline",onClick:()=>{Qt.deletePlot(r.id)},visibility:"hidden"})),r.children):d.createElement(Q,{thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500",size:"xl"}))},qt=["#c7566f","#57bf67","#845ec9","#90b83d","#d3a333","#c363ab","#4a7c38","#adab63","#698ccc","#c94f32","#826627","#52b8a4","#d88e61"],Vt=Z.exports.createContext({hoveredGene:""});var Ut=ee((e=>{const[t,n]=d.useState(""),a=d.useRef(null),o=d.useRef(null),r=d.useRef(),[l,c]=d.useState({title:{text:e.options.plotTitle,font:{size:20},y:.9},showlegend:e.options.showlegend,legend:{orientation:"h",x:0,y:-.3},yaxis:{title:{text:`count [${It.unit}]`},hoverformat:".2f"},autosize:!0,colorway:qt}),m={toImageButtonOptions:{format:"svg",filename:"plot"},displaylogo:!1,modeBarButtonsToRemove:["zoom2d","pan2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","resetScale2d","hoverClosestCartesian","hoverCompareCartesian","hoverClosestGl2d","hoverClosestPie","toggleHover","resetViews","sendDataToCloud","toggleSpikelines"],modeBarButtonsToAdd:[{title:"Delete plot",name:"Delete plot",icon:{width:21,height:21,path:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},click:()=>{Qt.deletePlot(e.id)}}]};d.useEffect((function(){let e;const t=o.current,n=new ResizeObserver((t=>{clearTimeout(r.current),e=window.setTimeout((()=>{c((e=>s(i({},e),{width:t[0].target.clientWidth})))}),250),r.current=e}));return t&&n.observe(t),()=>{t&&n.unobserve(t),e&&clearTimeout(e)}}),[]);return d.createElement(Vt.Provider,{value:{hoveredGene:t}},d.createElement(Yt,{status:"idle",figureRef:o,id:e.id},d.createElement(te,{ref:e=>a.current=e,data:e.data,layout:l,config:m,onHover:t=>{var a;const{points:o}=t;if(1!==o.length||(null==(a=e.accessions)?void 0:a.length)<=1)return;const r=o[0].data.name;n(r)},onUnhover:()=>{n("")},style:{width:"100%",height:"100%"}}),d.createElement(v,{marginX:"12",width:"full",overflow:"auto",flexShrink:1.3},e.children)))}));const Xt=["solid","dot","dash","longdash","dashdot","longdashdot"],Kt=["circle","square","diamond","cross","triangle-up","pentagon"],Jt=e=>(Math.round(1e3*e)/1e3).toFixed(3);const Qt=new class{constructor(){this.plots=[],this._image=null,this.countUnit=null,N(this)}loadCountUnit(e){this.countUnit=e}get hasPlots(){return this.plots.length>0}clearPlots(){this.plots=[]}deletePlot(e){const t=this.plots.findIndex((t=>t.id===e));if(t>-1){const e=this.plots[t];if("image"===e.type){const t=e;URL.revokeObjectURL(t.src)}this.plots.splice(t,1)}}addHeatmapPlot(e,t){const n=q(),a={id:n,type:"heatmap",isLoading:!0},o=this.plots.push(a)-1;setTimeout((()=>Wt({replicates:t}).then(ae("addHeatmapPlot",(t=>{const a=s(i({},this.plots[o]),{isLoading:!1,binData:t.bins,tree:t.tree,plotTitle:e});this.plots[o].id===n&&(this.plots[o]=a)})))),100)}addImagePlot(e,t){const n={alt:t,id:q(),isLoading:!1,type:"image",src:e};this.plots.push(n)}addPCAPlot(e){const t=q(),n={id:t,type:"pca",isLoading:!0},a=this.plots.push(n)-1;setTimeout((()=>(async e=>{const t=Pt.toArrayOfColumns(),n=new ne(t),a=n.predict(t),o=[{x:a.getColumn(0),y:a.getColumn(1),type:"scatter",mode:"markers",text:Pt.colNames,textfont:{family:"Times New Roman"},textposition:"bottom center",marker:{size:12,color:Pt.getSubheaderColors(2)}}],r=n.getExplainedVariance();return{data:o,layout:{title:{text:e,font:{size:20}},xaxis:{title:{text:`PC-1 (fraction of variance explained: ~${Jt(r[0])})`}},yaxis:{title:{text:`PC-2 (fraction of variance explained: ~${Jt(r[1])})`}},autosize:!0,hovermode:"closest"}}})(e).then(ae("addPCAPlot",(e=>{const n=s(i(i({},this.plots[a]),e),{isLoading:!1});this.plots[a].id===t&&(this.plots[a]=n)})))),100)}addSingleGeneBarPlot(e,t){const n=((e,t)=>{const n=Pt.getRowAsTree(e),a=[];return It.groupOrder.forEach((e=>{const o=[[],[]],r=[],l=[];It.sampleOrder.forEach((t=>{const a=n[e][t];a&&(o[0].push(e),o[1].push(t),r.push(V(a)),l.push(U(a)))})),a.push({x:o,y:r,error_y:{type:"data",array:l,visible:!0},type:"bar",name:e,showlegend:t.showlegend})})),a})(e[0],t),a={id:q(),type:"plotly",isLoading:!1,accessions:e,data:n,options:t};this.plots.push(a)}addMultiGeneBarPlot(e,t){const n=((e,t)=>{const n=[];return e.forEach((e=>{const a=Pt.getRowAsTree(e),o=[[],[]],r=[],l=[];It.groupOrder.forEach((e=>{It.sampleOrder.forEach((t=>{const n=a[e][t];n&&(o[0].push(e),o[1].push(t),r.push(V(n)),l.push(U(n)))}))})),n.push({x:o,y:r,error_y:{type:"data",array:l,visible:!0},type:"bar",name:e,showlegend:t.showlegend})})),n})(e,t),a={id:q(),type:"plotly",isLoading:!1,accessions:e,data:n,options:t};this.plots.push(a)}addSingleGeneIndividualLinesPlot(e,t){const n=((e,t)=>{const n=Pt.getRowAsTree(e),a=[];return It.groupOrder.forEach((e=>{const o=[[],[]],r=[],l=[];It.sampleOrder.forEach((t=>{const a=n[e][t];a&&(o[0].push(e),o[1].push(t),r.push(V(a)),l.push(U(a)))})),a.push({x:o,y:r,error_y:{type:"data",array:l,visible:!0},type:"scatter",name:e,showlegend:t.showlegend})})),a})(e[0],t),a={id:q(),type:"plotly",isLoading:!1,accessions:e,data:n,options:t};this.plots.push(a)}addMultiGeneIndividualLinesPlot(e,t){const n=((e,t)=>{const n=[];return e.forEach(((e,a)=>{const o=Pt.getRowAsTree(e),r={color:qt[a]};It.groupOrder.forEach(((a,l)=>{const i=[[],[]],s=[],c=[];It.sampleOrder.forEach((e=>{const t=o[a][e];t&&(i[0].push(a),i[1].push(e),s.push(V(t)),c.push(U(t)))})),n.push({x:i,y:s,error_y:{type:"data",array:c,visible:!0},name:e,type:"scatter",showlegend:!(l>0)&&t.showlegend,line:r})}))})),n})(e,t),a={id:q(),type:"plotly",isLoading:!1,accessions:e,data:n,options:t};this.plots.push(a)}addStackedLinesPlot(e,t){const n=((e,t)=>{const n=[];let a=0,o=0;return e.forEach((r=>{const l=Pt.getRowAsTree(r);It.groupOrder.forEach((i=>{const s=[],c=[],d=[];"group"===t.colorBy?a++:o++,It.sampleOrder.forEach((e=>{const t=l[i][e];t&&(s.push(e),c.push(V(t)),d.push(U(t)))})),n.push({x:s,y:c,error_y:{type:"data",array:d,visible:!0},name:e.length>1?`${i} - ${r}`:i,type:"scatter",showlegend:t.showlegend,line:e.length>1?{color:qt[a],dash:Xt[o]}:{},marker:e.length>1?{symbol:Kt[o]}:{}})})),"group"===t.colorBy?(a=0,o++):(a++,o=0)})),n})(e,t),a={id:q(),type:"plotly",isLoading:!1,accessions:e,data:n,options:t};this.plots.push(a)}};async function Zt(e,t,n){const a=await fetch(e,n);if(!a||!a.ok)throw new Error(`Fetching resource "${e}" failed with status "${a.status}: ${a.statusText}"`);switch(t){case"blob":return await a.blob();case"json":return await a.json();case"text":return await a.text();case"url":return a.url;default:throw new Error(`Unsupported read method for ${e}`)}}function en(e,t){const n=e.split(/\r?\n|\r/);return{header:n.splice(0,1)[0].split(t.fieldSeparator).reduce(((e,n,a)=>(a===t.rowNameColumn||e.push(n),e)),[]),rows:n.reduce(((e,n)=>{if(!n)return e;const a=n.split(t.fieldSeparator),o=a.splice(t.rowNameColumn,1)[0];return Object.assign(e,{[o]:a})}),{})}}var tn=ee((()=>{const e=y({base:"100%",lg:"45%",xl:"30%"}),[t,n]=d.useState([]),a=e=>{Pt.removeColumns(e)},o=(e,a)=>{n(a?[...t,e]:t.filter((t=>t!==e)))},r=d.useRef(null),{isOpen:l,onOpen:i,onClose:s}=E(),c=d.useRef(null),{isOpen:m,onOpen:p,onClose:g}=E(),h=d.useRef(null),{isOpen:f,onOpen:b,onClose:v}=E(),x=d.useRef(null),{isOpen:w,onOpen:C,onClose:S}=E(),T=Pt.hasData;return d.createElement(u,{as:"main",flexGrow:1},d.createElement(St,{maxWidth:"17rem"},!It.preloaded.data&&d.createElement(yt,{text:"Load Expression Table",icon:oe,onClick:i}),!It.preloaded.data&&d.createElement(yt,{text:"Load Gene Info Table",icon:re,onClick:p}),!It.preloaded.data&&d.createElement(yt,{text:"Import GXP Database",icon:le,onClick:b}),d.createElement(yt,{text:"Export GXP Database",icon:ie,onClick:C}),!It.preloaded.data&&d.createElement(yt,{text:t.length>0?"Remove selected":"Remove All Data",icon:J,onClick:()=>{t.length>0?(Pt.removeColumns(...t),n([])):Pt.clearData()},disabled:!T})),d.createElement(u,{alignItems:"center",flexDirection:"column",padding:"2rem",width:"100%"},d.createElement(se,{role:"region","aria-label":"Loaded replicates",justify:"center",spacing:"1rem",width:"100%"},Pt.colNames.map((t=>d.createElement(ce,{key:t,width:e},d.createElement(_t,{"aria-label":t,key:t,name:t,onDelete:It.preloaded.data?void 0:a,onSelect:It.preloaded.data?void 0:o,tabIndex:It.preloaded.data?0:void 0})))))),d.createElement(Tt,{initialFocusRef:r,isOpen:l,onClose:s,title:"Load Expression Table"},d.createElement(Nt,{initialFocusRef:r,onCancel:s,onSubmit:(e,t)=>{Qt.loadCountUnit(Ft(e.countUnit)),It.loadgxpSettings({unit:e.countUnit,expression_field_sep:Ft(e.columnSep),expression_header_sep:Ft(e.headerSep)});const n=e.file;if(n)try{const a=new FileReader;a.onload=()=>{const t=en(a.result,{fieldSeparator:Ft(e.columnSep),rowNameColumn:0});Pt.loadFromObject(t,{multiHeader:e.headerSep}),It.setGroupOrder(Pt.groupsAsArray),It.setSampleOrder(Pt.samplesAsArray)},a.onloadend=()=>{t.setSubmitting(!1),s()},a.onerror=()=>{t.setSubmitting(!1),console.error("There was an error while reading the file")},a.readAsText(n)}catch(a){t.setSubmitting(!1),console.error(a.message)}}})),d.createElement(Tt,{initialFocusRef:c,isOpen:m,onClose:g,title:"Load Gene-Info Table"},d.createElement(Mt,{initialFocusRef:c,onCancel:g,onSubmit:(e,t)=>{const n=e.file;if(n)try{It.loadgxpSettings({info_field_sep:Ft(e.columnSep)});const a=new FileReader;a.onload=()=>{const t=en(a.result,{fieldSeparator:Ft(e.columnSep),rowNameColumn:0});At.loadFromObject(t)},a.onloadend=()=>{t.setSubmitting(!1),g()},a.onerror=()=>{t.setSubmitting(!1),console.error("There was an error while reading the file")},a.readAsText(n)}catch(a){t.setSubmitting(!1),console.error("There was an error while reading the file")}}})),d.createElement(Tt,{initialFocusRef:h,isOpen:f,onClose:v,title:"Import GXP Database"},d.createElement(zt,{initialFocusRef:h,onCancel:v,onSubmit:async(e,t)=>{const n=e.file;if(n)try{const e=new W,a=await e.loadAsync(n),o=a.files["GXP_settings.json"],r=await o.async("string"),l=JSON.parse(r);It.loadgxpSettings(l);const i=a.files["expression_table.txt"],s=en(await i.async("string"),{fieldSeparator:It.gxpSettings.expression_field_sep,rowNameColumn:0});if(Pt.loadFromObject(s,{multiHeader:It.gxpSettings.expression_header_sep}),!It.gxpSettings.groupOrder||0===It.gxpSettings.groupOrder.length){const e=Pt.groupsAsArray;It.setGroupOrder(e)}if(!It.gxpSettings.sampleOrder||0===It.gxpSettings.sampleOrder.length){const e=Pt.samplesAsArray;It.setSampleOrder(e)}const c=a.files["info_table.txt"];if(c){const e=en(await c.async("string"),{fieldSeparator:It.gxpSettings.info_field_sep,rowNameColumn:0});At.loadFromObject(e)}const d=a.files["image.png"];if(d){const e=await d.async("blob"),t=URL.createObjectURL(e);Qt.addImagePlot(t,"Database Image")}t.setSubmitting(!1),v()}catch(a){t.setSubmitting(!1),console.error(a.message)}}})),d.createElement(Tt,{initialFocusRef:x,isOpen:w,onClose:S,title:"Export GXP Database"},d.createElement(Dt,{initialFocusRef:x,onCancel:S,onSubmit:async(e,t)=>{try{const n=Pt.toString(Ft(e.columnSep)),a=At.hasData?At.toString(It.gxpSettings.info_field_sep):null,o=Qt.plots.find((e=>"image"===e.type)),r=JSON.stringify(Object.assign({},It.gxpSettings,{expression_field_sep:Ft(e.columnSep)}),null,2),l=new W;if(l.file("GXP_settings.json",r),l.file("expression_table.txt",n),a&&l.file("info_table.txt",a),o){const e=await Zt(o.src,"blob");e&&l.file("image.png",e,{base64:!0})}l.generateAsync({type:"blob"}).then((t=>{de.exports.saveAs(t,e.fileName+".zip")})).finally((()=>{t.setSubmitting(!1),S()}))}catch(n){t.setSubmitting(!1),console.error(n)}}})))}));const nn=()=>{const{path:e}=me();return d.createElement(ue,null,d.createElement(pe,{exact:!0,path:e,component:tn}))},an=b(u),on=b(v),rn=e=>{var t=e,{label:n,text:a,icon:o}=t,r=c(t,["label","text","icon"]);return d.createElement(h,s(i({},r),{_focus:i({outline:"none",borderLeftColor:"orange.600"},r._focus),_hover:i({borderLeftColor:"orange.600",boxShadow:"md",textDecoration:"none"},r._hover),backgroundColor:"white",borderLeft:"4px",borderLeftColor:"transparent",boxShadow:"xs",display:"flex",padding:5,rel:"noopener noreferrer",target:"_blank",tabIndex:0,width:"100%"}),o&&d.createElement(p,{as:o,color:"gray.600",height:"1.5rem",marginTop:1,marginRight:"1rem",width:"1.5rem"}),d.createElement(an,{as:"section",alignItems:"center",flexGrow:1,whileHover:"hover"},d.createElement(v,{width:"100%"},d.createElement(g,{as:"h1",fontSize:"xl",fontWeight:"semibold"},n),d.createElement(g,{marginTop:"1.5"},a)),d.createElement(on,{marginX:"1rem",variants:{hover:{x:[0,10],transition:{duration:.8,repeat:1/0,repeatType:"mirror"}}}},d.createElement(p,{as:ge,color:"orange.600",height:"1.5rem",width:"1.5rem"}))))},ln=()=>d.createElement(v,{as:"main",padding:6,width:"100%",__css:{"& a:not(:first-of-type)":{marginTop:"2rem"}}},d.createElement(rn,{icon:he,label:"User Manual",text:"\n          The user manual contains detailed information on how to load data\n          and create new plots. All the data loaded in the application is kept\n          private to your browser tab and will never be uploaded to the\n          internet.\n        ",href:"https://zendro-dev.gitbook.io/geneexpressionplots/documentation/user-manual"}),d.createElement(rn,{_hover:{textDecoration:"none"},icon:fe,label:"API",text:"\n          The application programming interface contains instructions for\n          advanced users that want to deploy this application with data\n          already pre-loaded. This type of deployment is useful to showcase\n          public datasets.\n        ",href:"https://zendro-dev.gitbook.io/geneexpressionplots/documentation/api"})),sn=()=>{const{path:e}=me();return d.createElement(ue,null,d.createElement(pe,{exact:!0,path:e,component:ln}))},cn=e=>{var t=e,{controlProps:n,hideLabel:a,initialFocusRef:o,label:r,name:l,validate:m}=t,p=c(t,["controlProps","hideLabel","initialFocusRef","label","name","validate"]);const[g,h]=P({name:l,validate:m});return d.createElement(A,s(i({},n),{isInvalid:void 0!==h.error&&void 0!==h.touched}),d.createElement(u,{alignItems:"flex-end"},d.createElement(be,i({colorScheme:"orange",ref:e=>o?o.current=e:e,isChecked:g.value,name:g.name,onBlur:g.onBlur,onChange:g.onChange},p)),a?d.createElement(I,null,d.createElement(F,{htmlFor:p.id},r)):d.createElement(F,{fontWeight:"semibold",color:"gray.600",htmlFor:p.id,marginBottom:0,marginLeft:"1rem"},r)),d.createElement(z,{as:"span"},h.error))};const dn=e=>{var t=e,{children:n,controlProps:a,groupProps:o,hideLabel:r,initialFocusRef:l,label:m,leftChildren:u,name:p,rightChildren:g,validate:h}=t,f=c(t,["children","controlProps","groupProps","hideLabel","initialFocusRef","label","leftChildren","name","rightChildren","validate"]);const[b,E]=P({name:p,validate:h}),x=function(e){const t=d.useCallback((e=>{const t=Pt.rowNames,n=[];for(let a=0;a<t.length&&(t[a].includes(e)&&n.push(t[a]),!(n.length>=10));a++);return n}),[]),n=d.useMemo((()=>{if(void 0!==(null==e?void 0:e.accession))return t(null==e?void 0:e.accession)}),[t,null==e?void 0:e.accession]);return null!=n?n:t}({accession:b.value});return d.createElement(A,s(i({},a),{isInvalid:void 0!==E.error&&void 0!==E.touched,isRequired:f.isRequired}),r?d.createElement(I,null,d.createElement(F,{fontWeight:"semibold"},m)):d.createElement(F,{fontWeight:"semibold"},m),d.createElement(D,i({as:"span"},o),u,d.createElement(j,s(i({ref:e=>l?l.current=e:e,name:b.name,onBlur:b.onBlur,onChange:b.onChange,multiple:b.multiple,value:b.value},f),{list:`${b.name}-list`})),d.createElement(v,{as:"datalist",id:`${b.name}-list`},x.map((e=>d.createElement(v,{as:"option",key:e,value:e})))),n,g),d.createElement(z,{as:"span"},E.error))},mn=e=>{const t=e=>Pt.getRow(e)?e?void 0:"The accession ID cannot be empty":"The accession ID does not exist";return d.createElement(B,{initialValues:{accessions:[""],plotTitle:"",withCaption:!0,withLegend:!0},onSubmit:e.onSubmit,validateOnBlur:!1},(n=>d.createElement(v,{as:G},d.createElement(v,{as:"fieldset"},d.createElement(I,{as:"legend"},"Legend and caption switches"),d.createElement(u,{as:"ul",listStyleType:"none"},d.createElement(cn,{controlProps:{as:"li"},color:"orange.600",id:"plot-legend",label:"Legend",name:"withLegend"}),d.createElement(cn,{controlProps:{as:"li"},color:"orange.600",id:"plot-caption",label:"Caption",name:"withCaption"}))),d.createElement(kt,{controlProps:{as:"p",marginTop:"1rem"},initialFocusRef:e.initialFocusRef,label:"Plot Title",name:"plotTitle"}),d.createElement(Ee,{name:"accessions"},(e=>d.createElement(v,{as:"fieldset"},d.createElement(I,{as:"legend"},"Gene Accessions"),n.values.accessions&&n.values.accessions.length>0&&n.values.accessions.map(((a,o)=>d.createElement(dn,{controlProps:{as:"p",marginTop:"1rem"},groupProps:{_focusWithin:{"& > button":{display:"inline-flex"}}},isRequired:!0,key:o,label:`Gene Accession ${o+1}`,name:`accessions.${o}`,rightChildren:n.values.accessions.length>1&&d.createElement(ve,{_focusWithin:{backgroundColor:"white"},_hover:{backgroundColor:"white"},as:"span",padding:0},d.createElement(X,{_focus:{color:"red.600",outline:"none"},_groupHover:{color:"red.600"},"aria-label":`Remove ${a}`,color:"gray.600",display:"flex",justifyContent:"center",icon:d.createElement(xe,null),onClick:()=>e.remove(o),size:"md",variant:"unstyled"})),validate:t},d.createElement(v,{display:"none",color:"gray.500",_groupFocus:{display:"inline-flex"},_groupHover:{display:"inline-flex"},_focus:{backgroundColor:"orange.600",color:"white",outline:"none"},_hover:{backgroundColor:"orange.600",color:"white"},alignItems:"center",as:"button","aria-label":"Insert new below",backgroundColor:"white",height:"1rem",justifyContent:"center",left:"43%",padding:".75rem",position:"absolute",rounded:"full",top:"28px",type:"button",width:"1rem",zIndex:"popover",onClick:()=>e.insert(o+1,"")},d.createElement(p,{as:ye}))))),d.createElement(O,{_focus:{outline:"none",backgroundColor:"orange.100"},_hover:{backgroundColor:"orange.100"},colorScheme:"orange",marginTop:"1rem",type:"button",onClick:()=>e.push(""),variant:"ghost"},"Add New")))),d.createElement(u,{as:"p",paddingY:6,justifyContent:"flex-end"},d.createElement(O,{onClick:e.onCancel,colorScheme:"red",variant:"ghost"},"Cancel"),d.createElement(O,{colorScheme:"orange",isLoading:n.isSubmitting,marginLeft:".5rem",type:"submit",variant:"solid"},"Load")))))};var un,pn;(pn=un||(un={})).EMPTY_REPLICATE="A replicate field cannot be empty",pn.MIN_OPTIONAL_REPLICATES="At least two replicates must be selected";const gn=e=>{const t=e=>{if(!e)return un.EMPTY_REPLICATE};return d.createElement(B,{initialValues:{replicates:[],plotTitle:""},validateOnBlur:!1,validate:e=>{if(1===e.replicates.length)return{replicates:[un.MIN_OPTIONAL_REPLICATES]}},onSubmit:e.onSubmit},(n=>{var a;return d.createElement(d.Fragment,null,(null==(a=n.errors.replicates)?void 0:a[0])===un.MIN_OPTIONAL_REPLICATES&&d.createElement(I,null,d.createElement(we,{status:"error",variant:"subtle",alignItems:"center"},d.createElement(Ce,{mr:4}),d.createElement(v,{flex:"1"},d.createElement(Se,{fontSize:"lg"},"Errors"),d.createElement(Te,{display:"block"},un.MIN_OPTIONAL_REPLICATES)),d.createElement(_e,{position:"absolute",right:"8px",top:"8px"}))),d.createElement(v,{as:G},d.createElement(kt,{controlProps:{as:"p",marginTop:"1rem"},initialFocusRef:e.initialFocusRef,label:"Plot Title",name:"plotTitle"}),d.createElement(Ee,{name:"replicates"},(e=>d.createElement(v,{as:"fieldset"},d.createElement(I,{as:"legend"},"Replicates"),n.values.replicates.length>0&&n.values.replicates.map(((n,a)=>d.createElement(kt,{controlProps:{as:"p",marginTop:"1rem"},groupProps:{_focusWithin:{"& > button":{display:"inline-flex"}}},isRequired:!0,key:a,label:`Replicate ${a+1}`,name:`replicates.${a}`,rightChildren:d.createElement(ve,{_focusWithin:{backgroundColor:"white"},_hover:{backgroundColor:"white"},as:"span",padding:0},d.createElement(X,{_focus:{color:"red.600",outline:"none"},_groupHover:{color:"red.600"},"aria-label":`Remove ${n}`,color:"gray.600",display:"flex",justifyContent:"center",icon:d.createElement(xe,null),onClick:()=>e.remove(a),size:"md",variant:"unstyled"})),validate:t},d.createElement(v,{display:"none",color:"gray.500",_groupFocus:{display:"inline-flex"},_groupHover:{display:"inline-flex"},_focus:{backgroundColor:"orange.600",color:"white",outline:"none"},_hover:{backgroundColor:"orange.600",color:"white"},alignItems:"center",as:"button","aria-label":"Insert new below",backgroundColor:"white",height:"1rem",justifyContent:"center",left:"43%",padding:".75rem",position:"absolute",rounded:"full",top:"28px",type:"button",width:"1rem",zIndex:"popover",onClick:()=>e.insert(a+1,"")},d.createElement(p,{as:ye}))))),d.createElement(O,{_focus:{outline:"none",backgroundColor:"orange.100"},_hover:{backgroundColor:"orange.100"},colorScheme:"orange",marginTop:"1rem",type:"button",onClick:()=>{0===n.values.replicates.length?(e.push(""),e.push("")):e.push("")},variant:"ghost"},0===n.values.replicates.length?"Optional: Select Replicates":"Add Another Replicate")))),d.createElement(u,{as:"p",paddingY:6,justifyContent:"flex-end"},d.createElement(O,{onClick:e.onCancel,colorScheme:"red",variant:"ghost"},"Cancel"),d.createElement(O,{colorScheme:"orange",isLoading:n.isSubmitting,marginLeft:".5rem",type:"submit",variant:"solid"},"Load"))))}))};function hn(e,t){return Math.max(...e.map(t))}function fn(e,t){return Math.min(...e.map(t))}const bn=e=>e.bins,En=e=>e.count,vn=e=>{var t;const{tooltipData:n,tooltipLeft:a,tooltipTop:o,tooltipOpen:r,showTooltip:l,hideTooltip:i}=ke(),{containerRef:s,TooltipInPortal:c}=Re({detectBounds:!0,scroll:!0}),m=fn(e.binData,(e=>fn(bn(e),En))),u=hn(e.binData,(e=>hn(bn(e),En))),p=Oe({range:["#f33d15","#b4fbde"],domain:[m,u]}),h=d.useRef(null),f=d.useRef(),[b,E]=d.useState(),v=Z.exports.useMemo((()=>Le(e.tree)),[e.tree]);return d.useEffect((function(){let t;const n=h.current,a=new ResizeObserver((n=>{f.current&&clearTimeout(f.current),E(void 0),t=window.setTimeout((()=>{const t=window.getComputedStyle(n[0].target,null),a=parseFloat(t.getPropertyValue("padding-top")),o=parseFloat(t.getPropertyValue("padding-bottom")),r=parseFloat(t.getPropertyValue("padding-left")),l=parseFloat(t.getPropertyValue("padding-right"))+r,i=a+o,s=e.plotTitle?30:0,c=6*Math.max(...e.binData.map((e=>e.bin.length))),d=n[0].target.clientWidth-l-10-(null!=c?c:0),m=n[0].target.clientHeight-i-(null!=c?c:0)-10-2*s,u=m/6,p=m-u,g=e.binData.length,h=d/g,f=p/g,b=Oe({domain:[0,e.binData.length],range:[0,d]}),v=Oe({domain:[0,e.binData.length],range:[0,p]}),x=Pe({domain:e.binData.map((e=>e.bin)),range:[0,d]}),y=Pe({domain:e.binData[0].bins.map((e=>e.bin)),range:[0,p]});E({binWidth:h,binHeight:f,tickLineSize:10,titleHeight:s,tickLabelSize:c,xScaleAxis:x,xScalePlot:b,yScaleAxis:y,yScalePlot:v,xMax:d,yMax:m,treeBoundsY:u,heatmapBoundsY:p})}),100),f.current=t}));return n&&a.observe(n),()=>{n&&a.unobserve(n),t&&clearTimeout(t)}}),[e.binData,e.plotTitle]),d.createElement(Yt,{justifyContent:"center",status:b?"idle":"loading",figureRef:h,position:"relative",height:1200,plotType:"heatmap",id:e.id},b&&d.createElement("svg",{className:"main-svg",width:"100%",height:"100%",ref:s},d.createElement(Ae,null,d.createElement(Ie,{x:b.xMax/2+b.tickLabelSize,y:15,textAnchor:"middle",fontSize:20},e.plotTitle)),d.createElement(Ae,{top:b.titleHeight,left:b.tickLabelSize+b.tickLineSize},d.createElement(Fe,{root:v,size:[b.xMax,b.treeBoundsY],separation:()=>5},(e=>d.createElement(Ae,null,e.links().map(((e,t)=>d.createElement(De,{key:`cluster-link-${t}`,data:e,stroke:"black",strokeWidth:"1",fill:"none",percent:0}))),e.descendants().map(((e,t)=>d.createElement(Ae,{top:e.y,left:e.x,key:`cluster-node-${t}`},!e.children&&d.createElement(Ie,{dy:10,fontSize:10,fontFamily:"Arial",textAnchor:"end",angle:270,dx:4},e.data.name)))))))),d.createElement(Ae,{top:b.titleHeight+b.treeBoundsY+b.tickLabelSize,left:b.tickLabelSize+b.tickLineSize},d.createElement(je,{data:e.binData,xScale:e=>(null==b?void 0:b.xScalePlot)?b.xScalePlot(e):0,yScale:e=>(null==b?void 0:b.yScalePlot)?b.yScalePlot(e):0,colorScale:p,binWidth:null==b?void 0:b.binWidth,binHeight:null==b?void 0:b.binHeight,bins:e=>e&&e.bins,count:e=>e&&e.count,gap:1},(e=>e.map((e=>e.map((e=>d.createElement("rect",{key:`heatmap-rect-${e.row}-${e.column}`,width:e.width,height:e.height,x:e.x,y:e.y,fill:e.color,fillOpacity:e.opacity,onMouseOver:()=>{l({tooltipData:e,tooltipTop:e.y+b.titleHeight+b.treeBoundsY+b.tickLabelSize,tooltipLeft:e.x})},onMouseOut:i}))))))),d.createElement(ze,{left:-10,numTicks:e.binData.length,tickLabelProps:()=>({lengthAdjust:"spacing",fontSize:10,textAnchor:"end",dy:3,dx:-3}),scale:b.yScaleAxis}))),r&&n&&d.createElement(c,{left:a,top:o},d.createElement("p",null,d.createElement(g,{as:"span",fontWeight:"semibold"},"Column"),d.createElement(g,{as:"span",ml:1},e.binData[n.column].bin)),d.createElement("p",null,d.createElement(g,{as:"span",fontWeight:"semibold"},"Row"),d.createElement(g,{as:"span",ml:1},e.binData[n.column].bins[n.row].bin)),d.createElement("p",null,d.createElement(g,{as:"span",fontWeight:"semibold"},"Distance"),d.createElement(g,{as:"span",ml:1},null==(t=n.count)?void 0:t.toFixed(2)))))},xn=e=>{var t=e,{alt:n,src:a,id:o}=t,r=c(t,["alt","src","id"]);return d.createElement(Yt,{"aria-label":n,id:o,plotType:"image",status:"idle"},d.createElement(Me,i({alt:n,backgroundColor:"white",objectFit:"scale-down",src:a,width:"100%"},r)))};var yn,wn;(wn=yn||(yn={})).FILE_EMPTY="An image file is required",wn.FILE_FORMAT="Supported formats are: png",wn.ALT_EMPTY="An image label is required";const Cn=e=>{const t=e=>e?"image/png"!==e.type?yn.FILE_FORMAT:void 0:yn.FILE_EMPTY,n=e=>{if(!e)return yn.ALT_EMPTY};return d.createElement(B,{initialValues:{alt:""},validateOnBlur:!1,onSubmit:e.onSubmit},(a=>d.createElement(v,{as:G},d.createElement(kt,{controlProps:{as:"p",marginTop:"1rem"},initialFocusRef:e.initialFocusRef,isRequired:!0,label:"Image label",name:"alt",validate:n}),d.createElement(jt,{name:"file",label:"Image file",validate:t,isRequired:!0}),d.createElement(u,{as:"p",paddingY:6,justifyContent:"flex-end"},d.createElement(O,{onClick:e.onCancel,colorScheme:"red",variant:"ghost"},"Cancel"),d.createElement(O,{colorScheme:"orange",isLoading:a.isSubmitting,marginLeft:".5rem",type:"submit",variant:"solid"},"Add")))))};var Sn=ee((e=>{const t=d.useRef(null),n=d.useRef(null),a=d.useRef(),[o,r]=d.useState(e.layout),l={toImageButtonOptions:{format:"svg",filename:"plot"},displaylogo:!1,modeBarButtonsToRemove:["zoom2d","pan2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","resetScale2d","hoverClosestCartesian","hoverCompareCartesian","hoverClosestGl2d","hoverClosestPie","toggleHover","resetViews","sendDataToCloud","toggleSpikelines"],modeBarButtonsToAdd:[{title:"Delete plot",name:"Delete plot",icon:{width:21,height:21,path:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},click:()=>{Qt.deletePlot(e.id)}}]};return d.useEffect((function(){let e;const t=n.current,o=new ResizeObserver((t=>{clearTimeout(a.current),e=window.setTimeout((()=>{r((e=>s(i({},e),{width:t[0].target.clientWidth})))}),250),a.current=e}));return t&&o.observe(t),()=>{t&&o.unobserve(t),e&&clearTimeout(e)}}),[]),d.createElement(Yt,{status:"idle",figureRef:n,id:e.id},d.createElement(te,{ref:e=>t.current=e,data:e.data,layout:o,config:l,style:{width:"100%",height:"100%"}}))}));const Tn=e=>{const t=e=>Pt.getRow(e)?e?void 0:"The accession ID cannot be empty":"The accession ID does not exist";return d.createElement(B,{initialValues:{accessions:[""],plotTitle:"",withCaption:!0,withLegend:!0},onSubmit:e.onSubmit,validateOnBlur:!1},(n=>d.createElement(v,{as:G},d.createElement(v,{as:"fieldset"},d.createElement(I,{as:"legend"},"Legend and caption switches"),d.createElement(u,{as:"ul",listStyleType:"none"},d.createElement(cn,{controlProps:{as:"li"},color:"orange.600",id:"plot-legend",label:"Legend",name:"withLegend"}),d.createElement(cn,{controlProps:{as:"li"},color:"orange.600",id:"plot-caption",label:"Caption",name:"withCaption"}))),d.createElement(kt,{controlProps:{as:"p",marginTop:"1rem"},initialFocusRef:e.initialFocusRef,label:"Plot Title",name:"plotTitle"}),d.createElement(Ee,{name:"accessions"},(e=>d.createElement(v,{as:"fieldset"},d.createElement(I,{as:"legend"},"Gene Accessions"),n.values.accessions&&n.values.accessions.length>0&&n.values.accessions.map(((a,o)=>d.createElement(dn,{controlProps:{as:"p",marginTop:"1rem"},groupProps:{_focusWithin:{"& > button":{display:"inline-flex"}}},isRequired:!0,key:o,label:`Gene Accession ${o+1}`,name:`accessions.${o}`,rightChildren:n.values.accessions.length>1&&d.createElement(ve,{_focusWithin:{backgroundColor:"white"},_hover:{backgroundColor:"white"},as:"span",padding:0},d.createElement(X,{_focus:{color:"red.600",outline:"none"},_groupHover:{color:"red.600"},"aria-label":`Remove ${a}`,color:"gray.600",display:"flex",justifyContent:"center",icon:d.createElement(xe,null),onClick:()=>e.remove(o),size:"md",variant:"unstyled"})),validate:t},d.createElement(v,{display:"none",color:"gray.500",_groupFocus:{display:"inline-flex"},_groupHover:{display:"inline-flex"},_focus:{backgroundColor:"orange.600",color:"white",outline:"none"},_hover:{backgroundColor:"orange.600",color:"white"},alignItems:"center",as:"button","aria-label":"Insert new below",backgroundColor:"white",height:"1rem",justifyContent:"center",left:"43%",padding:".75rem",position:"absolute",rounded:"full",top:"28px",type:"button",width:"1rem",zIndex:"popover",onClick:()=>e.insert(o+1,"")},d.createElement(p,{as:ye}))))),d.createElement(O,{_focus:{outline:"none",backgroundColor:"orange.100"},_hover:{backgroundColor:"orange.100"},colorScheme:"orange",marginTop:"1rem",type:"button",onClick:()=>e.push(""),variant:"ghost"},"Add New")))),d.createElement(u,{as:"p",paddingY:6,justifyContent:"flex-end"},d.createElement(O,{onClick:e.onCancel,colorScheme:"red",variant:"ghost"},"Cancel"),d.createElement(O,{colorScheme:"orange",isLoading:n.isSubmitting,marginLeft:".5rem",type:"submit",variant:"solid"},"Load")))))},_n=({controlProps:e,direction:t,hideLabel:n,label:a,name:o,options:r,validate:l})=>{const[c,m,u]=P({name:o,validate:l});return d.createElement(A,s(i({},e),{isInvalid:void 0!==m.error&&void 0!==m.touched}),n?d.createElement(I,null,d.createElement(F,{fontWeight:"semibold"},a)):d.createElement(F,{fontWeight:"semibold"},a),d.createElement(Ne,{name:c.name,value:c.value,onChange:e=>{u.setValue(e)}},d.createElement(x,{direction:t},r.map(((e,t)=>d.createElement(Be,i({colorScheme:"orange",key:`${e.label}-${t}`,value:e.value,isDisabled:e.disabled},e),e.label))))),d.createElement(z,{as:"span"},m.error))},kn=e=>{const t=e=>Pt.getRow(e)?e?void 0:"The accession ID cannot be empty":"The accession ID does not exist";return d.createElement(B,{initialValues:{accessions:[""],plotTitle:"",withCaption:!0,withLegend:!0,colorBy:"group"},onSubmit:e.onSubmit,validateOnBlur:!1},(n=>d.createElement(v,{as:G},d.createElement(v,{as:"fieldset"},d.createElement(I,{as:"legend"},"Legend and caption switches"),d.createElement(u,{as:"ul",listStyleType:"none"},d.createElement(cn,{controlProps:{as:"li"},color:"orange.600",id:"plot-legend",label:"Legend",name:"withLegend"}),d.createElement(cn,{controlProps:{as:"li"},color:"orange.600",id:"plot-caption",label:"Caption",name:"withCaption"}))),d.createElement(kt,{controlProps:{as:"p",marginTop:"1rem"},initialFocusRef:e.initialFocusRef,label:"Plot Title",name:"plotTitle"}),d.createElement(_n,{controlProps:{as:"p",marginTop:"1rem"},direction:"row",label:"Color by",name:"colorBy",options:[{label:"Group",value:"group",disabled:!1},{label:"Accession",value:"accession",disabled:1===n.values.accessions.length}]}),d.createElement(Ee,{name:"accessions"},(e=>d.createElement(v,{as:"fieldset"},d.createElement(I,{as:"legend"},"Gene Accessions"),n.values.accessions&&n.values.accessions.length>0&&n.values.accessions.map(((a,o)=>d.createElement(dn,{controlProps:{as:"p",marginTop:"1rem"},groupProps:{_focusWithin:{"& > button":{display:"inline-flex"}}},isRequired:!0,key:o,label:`Gene Accession ${o+1}`,name:`accessions.${o}`,rightChildren:n.values.accessions.length>1&&d.createElement(ve,{_focusWithin:{backgroundColor:"white"},_hover:{backgroundColor:"white"},as:"span",padding:0},d.createElement(X,{_focus:{color:"red.600",outline:"none"},_groupHover:{color:"red.600"},"aria-label":`Remove ${a}`,color:"gray.600",display:"flex",justifyContent:"center",icon:d.createElement(xe,null),onClick:()=>e.remove(o),size:"md",variant:"unstyled"})),validate:t},d.createElement(v,{display:"none",color:"gray.500",_groupFocus:{display:"inline-flex"},_groupHover:{display:"inline-flex"},_focus:{backgroundColor:"orange.600",color:"white",outline:"none"},_hover:{backgroundColor:"orange.600",color:"white"},alignItems:"center",as:"button","aria-label":"Insert new below",backgroundColor:"white",height:"1rem",justifyContent:"center",left:"43%",padding:".75rem",position:"absolute",rounded:"full",top:"28px",type:"button",width:"1rem",zIndex:"popover",onClick:()=>e.insert(o+1,"")},d.createElement(p,{as:ye}))))),d.createElement(O,{_focus:{outline:"none",backgroundColor:"orange.100"},_hover:{backgroundColor:"orange.100"},colorScheme:"orange",marginTop:"1rem",type:"button",onClick:()=>e.push(""),variant:"ghost"},"Add New")))),d.createElement(u,{as:"p",paddingY:6,justifyContent:"flex-end"},d.createElement(O,{onClick:e.onCancel,colorScheme:"red",variant:"ghost"},"Cancel"),d.createElement(O,{colorScheme:"orange",isLoading:n.isSubmitting,marginLeft:".5rem",type:"submit",variant:"solid"},"Load")))))},Rn=({color:e,accession:t,geneInfo:n})=>d.createElement(v,{as:"div",px:"2"},d.createElement(u,{alignItems:"center",mb:"4"},d.createElement(v,{fontWeight:"semibold",fontSize:"lg",px:"2",color:e},t)),n.size>0?[...n.entries()].map((([e,n])=>d.createElement(u,{key:`${t}-${e}`},d.createElement(u,{flexShrink:"unset",ml:"2",py:"1",w:"36",textTransform:"uppercase",textColor:"yellow.700"},e),d.createElement(u,{ml:"5",py:"1",wordBreak:"break-all"},n)))):"No information available for this gene."),On=e=>d.createElement(Vt.Consumer,null,(({hoveredGene:t})=>d.createElement(u,{as:"figcaption",py:"5",textColor:"gray.600",textAlign:"justify",fontSize:"sm",_hover:{backgroundColor:"yellow.100"},_odd:{backgroundColor:"gray.100"}},d.createElement(Rn,{accession:e.accession,geneInfo:e.caption,color:e.color})))),Ln=e=>d.createElement(B,{initialValues:{plotTitle:""},validateOnBlur:!1,onSubmit:e.onSubmit},(t=>d.createElement(v,{as:G},d.createElement(kt,{controlProps:{as:"p",marginTop:"1rem"},initialFocusRef:e.initialFocusRef,label:"Plot Title",name:"plotTitle"}),d.createElement(u,{as:"p",paddingY:6,justifyContent:"flex-end"},d.createElement(O,{onClick:e.onCancel,colorScheme:"red",variant:"ghost"},"Cancel"),d.createElement(O,{colorScheme:"orange",isLoading:t.isSubmitting,marginLeft:".5rem",type:"submit",variant:"solid"},"Load")))));var Pn=ee((()=>{const e=d.useRef(null),{isOpen:t,onOpen:n,onClose:a}=E(),o=d.useRef(null),{isOpen:r,onOpen:l,onClose:c}=E(),m=d.useRef(null),{isOpen:p,onOpen:g,onClose:h}=E(),f=d.useRef(null),{isOpen:b,onOpen:v,onClose:x}=E(),y=d.useRef(null),{isOpen:w,onOpen:C,onClose:S}=E(),T=d.useRef(null),{isOpen:_,onOpen:k,onClose:R}=E(),O=Pt.hasData,L=Qt.hasPlots;return d.createElement(u,{as:"main",flexGrow:1},d.createElement(St,{background:"white",marginTop:5,minWidth:"4.5rem",maxWidth:"14rem",position:"fixed",boxShadow:"2xl",zIndex:"overlay"},d.createElement(yt,{text:"Bars",icon:Ge,onClick:n,disabled:!O}),d.createElement(yt,{text:"Individual Lines",icon:We,onClick:l,disabled:!O}),d.createElement(yt,{text:"Stacked Lines",icon:$e,onClick:g,disabled:!O}),d.createElement(yt,{text:"Heatmap",icon:He,onClick:v,disabled:!O}),d.createElement(yt,{text:"PCA",icon:Ye,onClick:C,disabled:!O}),d.createElement(yt,{text:"Image",icon:qe,onClick:k}),d.createElement(yt,{text:"Remove All",icon:J,onClick:()=>{Qt.clearPlots()},disabled:!L})),d.createElement(u,{"aria-label":"Visualizations",flexWrap:"wrap",role:"region",width:"100%",margin:2,marginLeft:20,overflow:"hidden"},!O&&d.createElement(we,{alignItems:"center",flexDirection:"column",minHeight:"16rem",maxHeight:"20rem",justifyContent:"center",marginLeft:3,marginTop:3,status:"warning",textAlign:"center",variant:"subtle"},d.createElement(Ce,{boxSize:"3rem",mr:0}),d.createElement(Se,{mt:4,mb:1,fontSize:"lg"},"No data has been loaded"),d.createElement(Te,{maxWidth:"xl"},"It seems no data has been loaded into the application yet. You can load data from various formats in the Data section of the toolbar above.")),Qt.plots.map((e=>{if(e.isLoading)return d.createElement(Yt,{key:e.id,status:"loading",id:e.id},d.createElement(Q,{key:`${e.id}-loading`,thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500",size:"xl"}));switch(e.type){case"heatmap":{const t=e;return d.createElement(vn,s(i({},t),{key:t.id}))}case"image":{const t=e;return d.createElement(xn,{key:e.id,alt:t.alt,id:t.id,src:t.src})}case"plotly":{const t=e;return d.createElement(Ut,s(i({},t),{key:t.id}),t.options.showCaption&&t.accessions.map(((e,n)=>d.createElement(On,{key:`${e}-${n}`,accession:e,caption:At.getRowAsMap(e),color:t.accessions.length>1?qt[n]:void 0}))))}case"pca":{const t=e;return d.createElement(Sn,i({key:t.id},t))}}}))),d.createElement(Tt,{initialFocusRef:e,isOpen:t,onClose:a,size:"xl",title:"Bars Plot",scrollBehavior:"outside"},d.createElement(mn,{initialFocusRef:e,onCancel:a,onSubmit:(e,t)=>{1===e.accessions.length?Qt.addSingleGeneBarPlot(e.accessions,{showlegend:e.withLegend,showCaption:e.withCaption,plotTitle:e.plotTitle}):Qt.addMultiGeneBarPlot(e.accessions,{showlegend:e.withLegend,showCaption:e.withCaption,plotTitle:e.plotTitle}),t.setSubmitting(!1),a()}})),d.createElement(Tt,{initialFocusRef:o,isOpen:r,onClose:c,size:"xl",title:"Individual Lines Plot",scrollBehavior:"outside"},d.createElement(Tn,{initialFocusRef:o,onCancel:c,onSubmit:(e,t)=>{1===e.accessions.length?Qt.addSingleGeneIndividualLinesPlot(e.accessions,{showlegend:e.withLegend,showCaption:e.withCaption,plotTitle:e.plotTitle}):Qt.addMultiGeneIndividualLinesPlot(e.accessions,{showlegend:e.withLegend,showCaption:e.withCaption,plotTitle:e.plotTitle}),t.setSubmitting(!1),c()}})),d.createElement(Tt,{initialFocusRef:m,isOpen:p,onClose:h,size:"xl",title:"Stacked Lines Plot",scrollBehavior:"outside"},d.createElement(kn,{initialFocusRef:m,onCancel:h,onSubmit:(e,t)=>{Qt.addStackedLinesPlot(e.accessions,{showlegend:e.withLegend,showCaption:e.withCaption,plotTitle:e.plotTitle,colorBy:e.colorBy}),t.setSubmitting(!1),h()}})),d.createElement(Tt,{initialFocusRef:f,isOpen:b,onClose:x,size:"xl",title:"Heatmap Plot",scrollBehavior:"outside"},d.createElement(gn,{initialFocusRef:f,onCancel:x,onSubmit:(e,t)=>{t.setSubmitting(!1),x(),setTimeout((()=>Qt.addHeatmapPlot(e.plotTitle,e.replicates)),10)}})),d.createElement(Tt,{initialFocusRef:y,isOpen:w,onClose:S,size:"xl",title:"PCA Plot",scrollBehavior:"outside"},d.createElement(Ln,{initialFocusRef:y,onCancel:S,onSubmit:(e,t)=>{t.setSubmitting(!1),S(),setTimeout((()=>Qt.addPCAPlot(e.plotTitle)),10)}})),d.createElement(Tt,{initialFocusRef:T,isOpen:_,onClose:R,size:"xl",title:"Image Plot",scrollBehavior:"outside"},d.createElement(Cn,{initialFocusRef:T,onCancel:R,onSubmit:(e,t)=>{if(t.setSubmitting(!1),R(),e.file){const t=URL.createObjectURL(e.file);Qt.addImagePlot(t,e.alt)}}})))}));const An=()=>{const{path:e}=me();return d.createElement(ue,null,d.createElement(pe,{exact:!0,path:e,component:Pn}))},In=b(u),Fn=b(v),Dn=e=>{var t=e,{label:n,text:a,icon:o}=t,r=c(t,["label","text","icon"]);return d.createElement(wt,s(i({},r),{_focus:i({outline:"none",borderLeftColor:"orange.600"},r._focus),_hover:i({borderLeftColor:"orange.600",boxShadow:"md",textDecoration:"none"},r._hover),backgroundColor:"white",borderLeft:"4px",borderLeftColor:"transparent",boxShadow:"xs",display:"flex",padding:5,tabIndex:0,width:"100%"}),o&&d.createElement(p,{as:o,color:"gray.600",height:"1.5rem",marginTop:"2",marginRight:"1rem",width:"1.5rem"}),d.createElement(In,{as:"section",alignItems:"center",flexGrow:1,whileHover:"hover"},d.createElement(v,{width:"100%"},d.createElement(g,{as:"h1",fontSize:"xl",fontWeight:"semibold"},n),d.createElement(g,{marginTop:"1.5"},a)),d.createElement(Fn,{marginX:"1rem",variants:{hover:{x:[0,10],transition:{duration:.8,repeat:1/0,repeatType:"mirror"}}}},d.createElement(p,{as:ge,color:"orange.600",height:"1.5rem",width:"1.5rem"}))))},jn=()=>d.createElement(v,{as:"main",padding:6,width:"100%",__css:{"& a:not(:first-of-type)":{marginTop:"2rem"}}},d.createElement(Dn,{icon:Ve,label:"Gene Browser",text:"\n          The gene browser provides is a tools to search and inspect the\n          individual gene information stored in the replicates database.\n          All searches are privately kept within your browser and will not be\n          sent anywhere.\n        ",to:"/tools/gene-browser"})),zn=e=>{var t=e,{accession:n,geneInfo:a}=t,o=c(t,["accession","geneInfo"]);return d.createElement(v,i({as:"section","aria-label":"Gene info card","aria-describedby":n,display:"flex",flexDirection:"column"},o),d.createElement(g,{as:"h1",color:"orange.600",fontWeight:"semibold",fontSize:"lg",id:n,marginBottom:2},n),a.size>0?[...a.entries()].map((([e,t])=>d.createElement(u,{key:`${e}-${n}`,paddingY:1},d.createElement(u,{flexShrink:0,marginLeft:2,maxWidth:36,fontWeight:"semibold",textColor:"gray.600",textTransform:"uppercase",width:36},e),d.createElement(u,{marginLeft:5,wordBreak:"break-all"},t)))):d.createElement(g,null,"There is no information available for this gene"))},Mn=e=>{const t=Pt.getRow(e.accessionId),n=It.gxpSettings.expression_header_sep,a=It.gxpSettings.unit,o=Pt.colNames.map(((e,a)=>[...e.split(n),t[a]]));return d.createElement(Ue,{colorScheme:"orange",variant:"striped"},d.createElement(Xe,null,"Expression count per replicate file found for this accession"),d.createElement(Ke,null,d.createElement(Je,{sx:{"& > th":{fontSize:14}}},d.createElement(Qe,null,"Group"),d.createElement(Qe,null,"Sample"),d.createElement(Qe,null,"Replicate"),d.createElement(Qe,{isNumeric:!0},"Count [",a,"]"))),d.createElement(Ze,null,o.map((([e,t,n,a])=>d.createElement(Je,{key:`${e}-${t}-${n}`,tabIndex:0,"aria-label":`Group: ${e}, Sample: ${t}, Replicate: ${n} Count: ${a}`,_focus:{outline:"2px solid",outlineColor:"orange.600"}},d.createElement(et,null,e),d.createElement(et,null,t),d.createElement(et,null,n),d.createElement(et,{isNumeric:!0},a))))),d.createElement(tt,null,d.createElement(Je,null,d.createElement(Qe,null,"Group"),d.createElement(Qe,null,"Sample"),d.createElement(Qe,null,"Replicate"),d.createElement(Qe,{isNumeric:!0},"Count [",a,"]"))))},Nn=e=>{var t=e,{children:n,controlProps:a,groupProps:o,hideLabel:r,initialFocusRef:l,label:m,leftChildren:u,name:p,rightChildren:g,validate:h}=t,f=c(t,["children","controlProps","groupProps","hideLabel","initialFocusRef","label","leftChildren","name","rightChildren","validate"]);const[b,E,v]=P({name:p,validate:h});return d.createElement(A,s(i({},a),{isInvalid:void 0!==E.error&&void 0!==E.touched,isRequired:f.isRequired}),r?d.createElement(I,null,d.createElement(F,{fontWeight:"semibold"},m)):d.createElement(F,{fontWeight:"semibold"},m),d.createElement(D,i({},o),u,d.createElement(nt,s(i({},f),{name:b.name,value:b.value,onChange:e=>v.setValue(e?parseFloat(e):"")}),d.createElement(at,{ref:e=>l?l.current=e:e}),d.createElement(ot,null,d.createElement(rt,null),d.createElement(lt,null))),n,g),d.createElement(z,{as:"span"},E.error))};var Bn,Gn;(Gn=Bn||(Bn={})).COUNT_EMPTY="The results value cannot be empty",Gn.COUNT_LT_ONE="Results cannot be less than 1",Gn.PAGE_EMPTY="The page number cannot be empty",Gn.PAGE_GT_MAX="The page number cannot be over the max",Gn.PAGE_LT_ONE="The page number cannot be less than 1";const Wn=e=>{var t=e,{initialFocusRef:n,onSubmit:a,pageMax:o}=t,r=c(t,["initialFocusRef","onSubmit","pageMax"]);const l=e=>"string"==typeof e&&""===e?Bn.PAGE_EMPTY:e<1?Bn.PAGE_LT_ONE:e>o?Bn.PAGE_GT_MAX:void 0,s=e=>"string"==typeof e&&""===e?Bn.COUNT_EMPTY:e<1?Bn.COUNT_LT_ONE:void 0;return d.createElement(B,{initialValues:{searchText:"",countView:20,pageNum:1},validateOnBlur:!1,onSubmit:a},(e=>d.createElement(u,i({as:G},r),d.createElement(kt,{controlProps:{flexShrink:.7,marginLeft:2},initialFocusRef:n,label:"Search in accessions",leftChildren:d.createElement(it,{_focusWithin:{backgroundColor:"white"},_hover:{backgroundColor:"white"},as:"span",padding:0},d.createElement(X,{_focus:{color:"orange.600",outline:"none"},_groupHover:{color:"orange.600"},"aria-label":"Search database",color:"gray.600",display:"flex",justifyContent:"center",icon:d.createElement(st,null),isLoading:e.isSubmitting,size:"md",type:"submit",variant:"unstyled"})),name:"searchText"}),d.createElement(Nn,{allowMouseWheel:!0,controlProps:{marginLeft:3},label:`Page ${e.values.pageNum} / ${o}`,name:"pageNum",min:1,max:o,validate:l,width:"100%"}),d.createElement(Nn,{allowMouseWheel:!0,controlProps:{marginLeft:3},label:"Results per page",name:"countView",min:1,validate:s,width:"100%"}))))},$n=()=>{const e=y({base:"full",lg:"6xl"}),{isOpen:t,onOpen:n,onClose:a}=E(),o=d.useRef(""),r=e=>()=>{o.current=e,n()},[l,i]=d.useState({geneCards:[],pageMax:1}),[s,c]=d.useState(!0),m=d.useCallback(((e,t,n)=>{const a=new RegExp(e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),"i");const o=Pt.rowNames.reduce(((e,t)=>{var n;const o=t.search(a)>-1,r=null!=(n=At.getRowAsMap(t))?n:new Map,l=!!r&&Array.from(r.values()).some((e=>e.search(a)>-1));return(o||l)&&e.push({accession:t,geneInfo:r}),e}),[]),r=(n-1)*t,l=n*t;return{geneCards:o.slice(r,l),pageMax:Math.ceil(o.length/t)||1}}),[]);d.useEffect((function(){c(!0);const e=m("",20,1);i(e),c(!1)}),[m]);const p=Pt.hasData;return d.createElement(u,{flexDirection:"column",backgroundColor:"white",flexGrow:1,padding:6},d.createElement(Wn,{alignItems:"start",flexDirection:{base:"column",md:"row"},justifyContent:"space-around",onSubmit:(e,t)=>{c(!0),setTimeout((()=>{const n=m(e.searchText,e.countView,e.pageNum);i(n),t.setSubmitting(!1),c(!1)}),10)},pageMax:l.pageMax}),p?s?d.createElement(u,{width:"100%",flexGrow:1,justifyContent:"center",alignItems:"center"},d.createElement(Q,{size:"xl"})):l.geneCards.map((({accession:e,geneInfo:t})=>d.createElement(zn,{_first:{marginTop:5},_even:{backgroundColor:"orange.50"},_hover:{backgroundColor:"orange.100",cursor:"pointer"},_focus:{outline:"none",border:"1px solid",borderColor:"orange.600",backgroundColor:"orange.100"},accession:e,border:"1px solid",borderColor:"transparent",geneInfo:t,key:e,padding:5,tabIndex:0,onDoubleClick:r(e),onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),r(e)())}}))):d.createElement(we,{alignItems:"center",flexDirection:"column",minHeight:"16rem",maxHeight:"20rem",justifyContent:"center",marginLeft:3,marginTop:3,status:"warning",textAlign:"center",variant:"subtle"},d.createElement(Ce,{boxSize:"3rem",mr:0}),d.createElement(Se,{mt:4,mb:1,fontSize:"lg"},"No data has been loaded"),d.createElement(Te,{maxWidth:"xl"},"It seems no data has been loaded into the application yet. You can load data from various formats in the Data section of the toolbar above.")),d.createElement(w,{isOpen:t,onClose:a,size:e},d.createElement(C,null),d.createElement(S,{margin:"full"===e?0:void 0,overflow:"auto",rounded:"none"},d.createElement(T,{color:"orange.600"},o.current),d.createElement(_,null),d.createElement(k,null,d.createElement(Mn,{accessionId:o.current})),d.createElement(ct,null,d.createElement(O,{colorScheme:"orange",mr:3,onClick:a},"Close")))))},Hn=()=>{const{path:e}=me();return d.createElement(ue,null,d.createElement(pe,{exact:!0,path:e,component:jn}),d.createElement(pe,{path:e+"/gene-browser",component:$n}))},Yn=()=>d.createElement(ue,null,d.createElement(pe,{exact:!0,path:"/",component:xt}),d.createElement(pe,{path:"/data",component:nn}),d.createElement(pe,{path:"/plots",component:An}),d.createElement(pe,{path:"/tools",component:Hn}),d.createElement(pe,{path:"/docs",component:sn})),qn=e=>{const t=y({base:"md",lg:"lg"}),n=dt(),a=("exact"===e.urlMatch||void 0===e.urlMatch)&&n.pathname===e.href||"contains"===e.urlMatch&&n.pathname.includes(e.href);return d.createElement(mt,null,d.createElement(wt,{_focus:{outline:"none",backgroundColor:"gray.100",textColor:"orange.600"},_hover:{backgroundColor:"gray.100",textColor:"orange.600"},alignItems:"center",borderRadius:"md",borderY:"2px",borderColor:a?"white":"transparent",display:"flex",flexDirection:"column",justifyContent:"center",paddingY:2,paddingX:4,textColor:"white",tabIndex:0,to:e.href},d.createElement(p,{as:e.icon,width:5,height:5}),d.createElement(g,{as:"span",fontSize:t,fontWeight:"semibold",userSelect:"none"},e.text)))},Vn=e=>d.createElement(v,i({as:"nav",paddingY:2,paddingX:5,backgroundColor:"orange.600",boxShadow:"xl"},e),d.createElement(ut,{display:"flex",justifyContent:"space-around",listStyleType:"none"},e.children)),Un=e=>d.createElement(u,i({flexDirection:"column",minHeight:"100vh",backgroundColor:"gray.100"},e),d.createElement(Vn,null,d.createElement(qn,{href:"/data",icon:pt,text:"Data",urlMatch:"contains"}),d.createElement(qn,{href:"/plots",icon:Ge,text:"Plots",urlMatch:"contains"}),d.createElement(qn,{href:"/tools",icon:gt,text:"Tools",urlMatch:"contains"}),d.createElement(qn,{href:"/docs",icon:ht,text:"Docs",urlMatch:"contains"})),e.children),Xn=()=>{const[e,t]=d.useState({status:"idle"});return d.useEffect((function(){(It.preloaded.data||It.preloaded.image||It.preloaded.info||It.preloaded.settings)&&(async()=>{var e;t({status:"loading"});try{if(It.preloaded.settings){const e=await Zt(It.preloaded.settings,"json");It.loadgxpSettings(e),Qt.loadCountUnit(It.gxpSettings.unit)}if(It.preloaded.data){const e=en(await Zt(It.preloaded.data,"text"),{fieldSeparator:It.gxpSettings.expression_field_sep,rowNameColumn:0});Pt.loadFromObject(e,{multiHeader:It.gxpSettings.expression_header_sep}),0===It.gxpSettings.groupOrder.length&&It.setGroupOrder(Pt.groupsAsArray),0===It.gxpSettings.sampleOrder.length&&It.setSampleOrder(Pt.samplesAsArray)}if(It.preloaded.info){const e=en(await Zt(It.preloaded.info,"text"),{fieldSeparator:It.gxpSettings.info_field_sep,rowNameColumn:0});At.loadFromObject(e,{multiHeader:"*"})}if(It.preloaded.image){const t=await Zt(It.preloaded.image,"url"),n=null==(e=t.split("/").pop())?void 0:e.split(".").shift();Qt.addImagePlot(t,n)}t({status:"idle"})}catch(n){t({status:"failed",message:n.message})}})()}),[]),d.createElement(ft,null,d.createElement(Un,null,"loading"===e.status?d.createElement(u,{alignItems:"center",flexDirection:"column",flexGrow:1,justifyContent:"center",width:"100%"},d.createElement(Q,{thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500",size:"xl"}),d.createElement(g,{fontSize:"xl",fontWeight:"semibold",marginTop:6},"Loading Application Data")):"failed"===e.status?d.createElement(we,{alignItems:"center",flexDirection:"column",justifyContent:"center",marginTop:10,padding:8,status:"error",textAlign:"center",variant:"subtle"},d.createElement(Ce,{boxSize:"2rem",marginRight:0}),d.createElement(Se,{marginTop:6,fontSize:"lg"},"The application failed to load"),d.createElement(Te,{marginTop:3,maxWidth:"xl"},"The application failed when trying to load data resources. You may try reloading the page. If the problem persists, please contact your administrator."),d.createElement(bt,{marginTop:6},e.message)):d.createElement(Yn,null)))};Et.render(d.createElement(d.StrictMode,null,d.createElement(vt,null,d.createElement(Xn,null))),document.getElementById("root"));
